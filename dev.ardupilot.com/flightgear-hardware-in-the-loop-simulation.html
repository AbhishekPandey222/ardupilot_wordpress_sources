<!-- 
START METADATA - Only title should be translated 
slug: flightgear-hardware-in-the-loop-simulation 
title: FlightGear Hardware-in-the-Loop Simulation 
id: 5951 
menu_order: 0 
post_parent_id: 0 
post_parent_stub:  
post_parent_title:  
END METADATA 
-->
<a href="http://www.flightgear.org/about/" title="About FlightGear">FlightGear</a> is an open-source free flight simulator. This article explains how to use this hardware-in-the-loop simulator with Plane (only).<!--more-->
[note]This is a community-submitted article. It should work, but has not been verified by the official dev team. Questions and requests for help should be made in the DIY Drones forums.[/note]

[caption id="attachment_1373" align="alignnone" width="800"]<a href="http://plane.ardupilot.com/wp-content/uploads/sites/3/2013/02/flightgear1.jpg"><img src="http://plane.ardupilot.com/wp-content/uploads/sites/3/2013/02/flightgear1.jpg" alt="Flightgear screenshot" width="800" height="344" class="size-full wp-image-1373" /></a> Flightgear screenshot[/caption]

<h1>Things you need</h1>

<ol>
	<li><a href="http://www.flightgear.org/" rel="nofollow">Flightgear</a> (tested Flight Gear v2.x, currently at v3.4)</li>
	<li><a href="http://firmware.ardupilot.org/Tools/MissionPlanner/MissionPlanner-latest.msi" rel="nofollow">Mission Planner</a> (Windows)</li>
	<li>ArduPilot HIL on your APM (via APM Planner, currently (April 2013) only v2.68 HIL works, see below)</li>
	<li><a href="https://ardupilot-mega.googlecode.com/svn/Tools/trunk/FlightGear/MAVLink.xml" rel="nofollow">Mavlink.xml</a> data format file for flightgear (Right Click and Save as)</li>
	<li>Recommended for Windows OS: the file: <a href="https://code.google.com/p/ardupilot-mega/downloads/detail?name=system.fgfsrc" rel="nofollow">system.fgfsrc</a> placed into the "C:\Program Files (x86)\FlightGear\data" folder. This will load the Rascal RC plane and a few other parameters. More information on what is loaded <a href="http://wiki.flightgear.org/Fgfsrc" rel="nofollow">here</a>, you can alter it to your own requirements.</li>
</ol>




<h1>How to make it work</h1>

[warning]Safety first: Disconnect the 3 wires from your brushless motor otherwise it will start when you advance the throttle (if in manual mode).[/warning]

<ol>
	<li>Download and install the FlightGear Flight Sim if you have not already</li>
	<li>Copy Mavlink.xml to C:\Program Files (x86)\FlightGear\data\Protocol</li>
	<li>In the Mission Planner &gt; 'Configuration tab | Adv Parameter List' save your current parameters so you can reload them after the simulation</li>
	<li>In the Firmware tab of the MP, choose 'Pick previous firmware', from the drop down list pick the 4th one down, firmware should show as Plane v2.68, then click 'HIL Simulator | Plane' to load the Plane firmware onto your APM.</li>
	<li>Connect to the APM, then open the Simulation tab of the Mission Planner</li>
	<li>Check the FlightGear radio button, then click the 'Start FG Plane' button.</li>
	<li>After FG has finished loading click the 'Sim Link Start/Stop' button in the MP</li>
	<li>In FG press ' v ' on the keyboard to get an outside view of the plane, ' x ' to zoom, move your aileron stick to see if the planes ailerons move, great if they do, go through this list again if not.</li>
	<li>Now in the Mission Planner do your usual radio setup including calibration and mode switch setup, then you can fly Missions and test the APM just like you would on a real plane.</li>
</ol>

[note]If you used the file "<a href="http://firmware.ardupilot.org/downloads/wiki/advanced_user_tools/windows_parameter_file_for_flightgear_HIL_simulator_system.fgfsrc.zip">system.fgfsrc</a>" then you can just increase your throttle to fly the Rascal plane. If you didn't and are flying the default Cessna, hold down 's' on the keyboard to start the plane's engine, then advance your throttle to take off.[/note]